from flask import Flask, request, jsonify
import io
import os
import json
from docx import Document
from docx.oxml.text.paragraph import CT_P
from docx.oxml.table import CT_Tbl
from docx.table import Table
from docx.text.paragraph import Paragraph
from flask_cors import CORS
from openai import OpenAI

app = Flask(__name__)
CORS(app)

client = OpenAI(api_key=os.environ["OPENAI_API_KEY"])

BASE_PROMPT = '''אתה פועל כמומחה מקצועי לבדיקת בקשות במסגרת מסלול תנופה של רשות החדשנות.  
אתה מקבל בכל הרצה שני קבצים מצורפים: application_form ו instructions_form.  
עליך לבדוק את כל הסעיפים בטופס.

רקע עבורך:  
רשות החדשנות היא גוף ממשלתי שתומך בפיתוח טכנולוגי בישראל. הבדיקות מתמקדות בחדשנות, עומק טכנולוגי, יכולת ביצוע, היתכנות במסגרת תקציב וזמן, והתאמה לשוק גלובלי.

מסלול תנופה מיועד למחקר ופיתוח ראשוני, הוכחת היתכנות או אב טיפוס. התקציב מוגבל והתקופה קצרה. התוכן חייב לשקף פעילות פיתוח ולא שיווק או תפעול.

כבודק אתה מבין לעומק מה מצופה בכל סעיף. אתה מזהה חוסרים, חוסר עקביות, פערים לוגיים, הצגה לא נכונה או הבטחות שאינן ריאליות. אתה מאבחן התאמה בין כל סעיף לבין כלל הטופס.

קלט שאתה מקבל:  
application_form: אובייקט JSON הכולל את כל תשובות היזם. לכל סעיף יש applicant_answer.  
instructions_form: אובייקט JSON הכולל לכל סעיף question, instructions, max_length אם קיים, ו review_guidelines.

המטרה:  
לבדוק את כל הסעיפים בטופס, לנתח כל סעיף לעומק, ולבחון גם חיבור וסתירות בין הסעיפים.

מותר לך:  
• להצליב בין סעיפים שונים.  
• להזכיר את שמות הסעיפים במפורש.  
• להצביע על סתירות בין חלקי הטופס.

אסור לך:  
• להתייחס ל review_guidelines במפורש או לצטט מהם.  
• לכתוב עבור היזם ניסוחים חדשים.  
• להמציא מידע שאינו קיים בטופס.

אופן העבודה שלך:  
לכל סעיף בטופס, קרא את ה question וה instructions שלו מתוך instructions_form.  
קרא את ה applicant_answer של אותו סעיף מתוך application_form.  

ראשית, עבור כל סעיף, בדוק האם ה applicant_answer שלו עונה באופן מלא על כל רכיבי ה question וה instructions של אותו סעיף, כולל כל תתי הסעיפים והנושאים הנדרשים. אם אחד מהם חסר או מטופל באופן חלקי בלבד, ההערות הראשונות שלך לגבי אותו סעיף חייבות להתייחס במפורש לחוסרים אלו ולציין מה לא כוסה ביחס לשאלה ולהנחיות.  

רק לאחר שהבטחת שכל דרישות השאלה וההנחיות כוסו ברמה מספקת, בדוק את איכות התשובה: עומק, בהירות, ריאליות, היתכנות במסגרת תנופה, ועקביות עם שאר הטופס. התבסס גם על הידע המשתמע מתוך ה review_guidelines, אך אל תזכיר אותם או תצטט מהם בתשובה. הוסף הערות רק כאשר קיימים ליקויים מהותיים או בעיות שיכולות לפגוע בהבנה, בהערכה המקצועית או בסיכויי האישור. אם לדעתך התשובה בסעיף מסוים עומדת ברמת איכות מספקת להגשה במסגרת תנופה, אל תיתן הערות כלל עבור אותו סעיף.  

עיין בסעיפים אחרים בטופס לפי הצורך לצורך זיהוי סתירות ופערים.  
כתוב רשימת הערות מקצועית וברורה בלבד המתארת מה חסר, מה לא עקבי, מה דורש חידוד ומה על היזם לשפר, לכל סעיף.  
אל תכתוב טיוטות או ניסוחים חלופיים. אל תוסיף מידע חדש שאינו מופיע בטופס.

שימוש בסעיפים לדוגמה:  
מצורפים שלושה סעיפים לדוגמה שנחשבים לרמת איכות מספקת להגשה:  
• executive_summary: דוגמה לסיכום מנהלים.  
• technology_uniqueness_innovation: דוגמה לסעיף טכנולוגי.  
• market_clients_competition_business_model: דוגמה לסעיף שוק ועסקי.  

הדוגמאות נועדו לתת לך הקשר על רמת העומק, הפירוט והבהירות הצפויה בסעיפים מסוגים שונים.  
כאשר אתה מחליט אם להוסיף הערות לכל סעיף, השווה באופן כללי את רמת האיכות של ה applicant_answer לדוגמאות.  
אם בסעיף מסוים כל דרישות השאלה וההנחיות כוסו ברמה מספקת, אין בעיות מהותיות של ריאליות או עקביות, ורמת העומק דומה לדוגמאות או גבוהה מהן, החזר עבור אותו סעיף "אין הערות".  
רק אם רמת האיכות נמוכה באופן מהותי או שיש פגמים משמעותיים, הוסף הערות ממוקדות.  
הדוגמאות שייכות למיזם אחר ומשמשות רק כמדד איכות. לעולם אל תתייחס אליהן כחלק מהטופס הנבדק.

בדיקת שפה:  
כל ההערות חייבות להיות בעברית תקינה.  
ללא אותיות לועזיות בתוך מילים.  
ללא שבירת מילים או תווים חריגים.  
ללא שגיאות הקלדה.


סעיפים לדוגמה:


executive_summary - סיכום מנהלים לדוגמה:

המיזם מפתח מנוע AI להערכת איכות תנועה קצרה מתוך וידאו מצולם בסמארטפון, ללא ציוד נוסף. הטכנולוגיה מבוססת על שלושה רכיבים עיקריים: זיהוי מפרקים קל משקל המותאם לתנאי בית, ניתוח דינמי של סדרות שלדי גוף לאורך 1 עד 3 שניות, ושכבת כיול אישי המותאמת למבנה הגוף של כל משתמש. האב טיפוס הקיים מזהה 5 תנועות בסיסיות בדיוק של כ 80 אחוז וזמן עיבוד של כ 5 שניות. בתקופת המענק המערכת תורחב ל 20 תנועות, הדיוק יעלה ל 90 אחוז ומעלה, וזמן העיבוד יירד לכ 2 שניות, לצד הרחבת מאגר הנתונים ובניית שכבת Transformer קלה לניתוח דינמי.

הצורך: אנשי מקצוע בתחום הפיזיותרפיה והשיקום זקוקים לכלי אמין ומהיר לבדיקת תנועה מרחוק, במיוחד בעבודה היברידית ובמעקב ביתי. משתמשים פרטיים מחפשים הערכת תנועה פשוטה שמתריעה על דפוסי תנועה בעייתיים ומספקת הכוונה בסיסית ללא הבנה מקצועית.

השוק: תחום ה Digital Musculoskeletal Assessment וה Tele-rehab מוערך בכ 7.5 מיליארד דולר בצמיחה שנתית של כ 14 אחוז. המיקוד המיידי הוא בשוק מצומצם של פיזיותרפיסטים עצמאיים ומרפאות קטנות ב 2 עד 3 מדינות מובילות, עם פיילוטים של עשרות אנשי מקצוע. נעשה תיקוף ראשוני מול 12 פיזיותרפיסטים ו 10 מאמנים, כולל פיילוט של כ 50 בדיקות תנועה.

בידול: המערכת מספקת הערכת תנועה אובייקטיבית בתנאים ביתיים באמצעות סמארטפון יחיד בלבד, עם דגש על תנועות קצרות ולא על תרגול ממושך. שכבת הכיול האישית מאפשרת חיווי מדויק יותר מאשר אפליקציות כושר כלליות או פתרונות שיקום שאינם מותאמים למבנה גוף אישי.

תחרות: פתרונות קיימים מתמקדים בשיקום באמצעות סט תרגילים או דורשים מצלמות עומק וציוד נוסף. מעט מאוד פתרונות מספקים בדיקת תנועה קצרה המבוססת על סמארטפון בלבד ברמת אמינות המתאימה לאיש מקצוע.

תכולת הפיתוח במענק: הרחבת כיסוי התנועות, שיפור מודול זיהוי המפרקים, פיתוח שכבת Transformer קלה, בניית מודל כיול אישי, הרחבת מאגר נתונים ל כ 500 סרטונים מתויגים, ואופטימיזציה למכשירי מובייל. כל המשימות מבוססות על פיתוח תוכנה ונתונים בלבד ומתאימות למסגרת תקציב וזמן של עד 12 חודשים.

הזדמנות עסקית ומודל הכנסות: מנוי חודשי למקצוענים (19 עד 39 דולר), מנוי למשתמשי קצה (5.99 עד 6.99 דולר), ו White Label עתידי למרפאות וחברות ביטוח. בשלב המענק המיקוד הוא באימות המודל מול אנשי מקצוע בלבד.

גיוס הון: לאחר השלמת אב הטיפוס המורחב והפיילוטים מתוכנן גיוס Seed לצורך הרחבת השוק, שיפור קליני והעמקת יכולות AI.



 -----------



technology_uniqueness_innovation - סעיף טכנולוגיה לדוגמה:

הטכנולוגיה, ייחודיות וחדשנות, חסמי כניסה טכנולוגיים, אתגרים, מוצרי צד ג'

הטכנולוגיה  
המיזם מפתח מנוע AI לניתוח מצבי תנועה קצרי טווח בווידאו ממצלמת סמארטפון ביתית. המערכת בנויה משלושה מודולים עיקריים:  
1. מודול Pose Estimation: רשת נוירונים קלת משקל, מותאמת למכשירי מובייל, שמאתרת כ 18 נקודות מפרק עיקריות בגוף גם בתאורה ביתית לא אחידה.  
2. מודול Dynamic Motion Analysis: מודל זמן מרחב שמקבל סדרת שלדי גוף לאורך 1 עד 3 שניות ומחשב מדדים כמו טווח תנועה, סימטריה ויציבות.  
3. מודול Feedback Generator: שכבת תרגום אלגוריתמית שממפה את המדדים הגולמיים לציון איכות תנועה ולהנחיות פשוטות להבנה עבור משתמש לא מקצועי.

סטטוס נוכחי  
קיים אב טיפוס ראשוני שפועל על מכשירי אנדרואיד מודרניים ומזהה 5 סוגי תנועה בסיסיים (כיפוף ברכיים, הרמת יד, סיבוב כתף, עמידה מישיבה, כפיפה קדימה).  
דיוק זיהוי המפרקים הממוצע עומד על כ 80 אחוז, וזמן העיבוד הוא כ 5 שניות למקטע וידאו של שניה אחת.  
האימון בוצע על בסיס:  
• 120 סרטונים של 30 משתמשים שונים  
• ארבעה סוגי רקע ותאורה (סלון, מטבח, חדר שינה, מסדרון)  
• שני סוגי מכשירים עיקריים ברמת ביניים  

מה יפותח בתקופת המענק (קפיצת המדרגה)  
במהלך תקופת המענק, מתוכננת הרחבה והעמקה של המערכת בנקודות הבאות:  
1. הרחבת כיסוי התנועות ל 20 תבניות תנועה מוגדרות היטב (בעיקר תנועות יומיומיות ופיזיותרפיות בסיסיות).  
2. שיפור דיוק זיהוי המפרקים מ 80 אחוז ל 90 אחוז ומעלה, תוך שמירה על זמן עיבוד של עד 2 שניות למקטע.  
3. פיתוח שכבת ניתוח דינמי חדשה המבוססת על Transformer קל משקל על סדרות שלדי גוף, לשיפור רגישות לשינויים קטנים בטווח תנועה.  
4. הוספת מודול כיול אישי שמותאם למבנה הגוף ולמנחי הצילום של כל משתמש, על בסיס מספר תנועות כיול קצרות בתחילת השימוש.  
5. התאמה רשמית לשני סוגי מערכות הפעלה (Android ו iOS) ללא צורך בציוד נוסף מעבר לסמארטפון.

מפרט ביצועים מתוכנן ומתודולוגיה  
דיוק זיהוי מפרקים מתוכנן: 90 עד 92 אחוז, נמדד מול תיוג ידני של לפחות 300 סרטונים של 60 משתמשים.  
דיוק זיהוי דפוסי תנועה (סיווג תקין לעומת חריג): 85 אחוז ומעלה עבור 20 סוגי תנועה, בתנאי תאורה ביתית.  
זמן עיבוד: לכל היותר 2 שניות למקטע וידאו של שניה אחת על מכשירי ביניים בני 3 עד 4 שנים.  
המדידה תתבצע על מאגר ייעודי שייאסף בתקופת המענק, שיכלול:  
• מגוון גילאים ומבני גוף  
• צילום מזוויות שונות (סטייה של עד 35 מעלות ממרכז הגוף)  
• תנאי תאורה ורקעים שונים המייצגים סביבת בית אמיתית  

ייחודיות וחדשנות ביחס לפתרונות קיימים  
רוב הפתרונות הקיימים לניתוח תנועה מדויק דורשים מצלמות עומק, מספר מצלמות או ציוד ייעודי. המיזם מתמקד בתרחיש ביתי פשוט: סמארטפון יחיד, ללא סמנים או חיישנים נוספים. החידוש הטכנולוגי העיקרי הוא בשילוב הבא:  
1. ארכיטקטורה דו שלבית שמפרידה במפורש בין שלב שלדי הגוף לבין שלב הניתוח הדינמי, ומאפשרת אופטימיזציה נפרדת לכל שכבה.  
2. מודול Transformer קל משקל שתוכנן במיוחד לרצפים קצרים מאוד של תנועה (1 עד 3 שניות), עם שימוש במספר קטן של פריימים מיוצגים במקום בכל פריימי הווידאו.  
3. שכבת כיול אישי שיוצרת פרופיל בסיס לכל משתמש, כך שהערכת הסטייה מהמצב התקין נעשית ביחס למבנה הגוף ולסגנון התנועה שלו ולא רק ביחס לממוצע כללי.  

כתוצאה מכך, המערכת מסוגלת להפיק מדדי איכות תנועה שימושיים בתנאים ביתיים ובתקציב חישובי נמוך, מבלי להסתמך על תשתיות חומרה יקרות.

חסמי כניסה טכנולוגיים והידע הייחודי שיפותח  
הידע הייחודי שיפותח במסגרת המיזם כולל:  
1. מאגר נתוני וידאו מסווג ומתוייג של תנועות יומיומיות בתנאי בית, עם תיוג כפול: גם שלדי גוף וגם הערכה מקצועית של איכות תנועה. המאגר אינו זמין היום כמאגר ציבורי ומצריך תכנון, איסוף ותיוג ייעודיים.  
2. ארכיטקטורה אופטימלית לתרחיש מובייל ביתי: שילוב מודלים דחוסים, קו עיבוד מפוצל בין מכשיר לקצה ענן, ואופטימיזציה לצריכת סוללה וזמן תגובה.  
3. מודלים סטטיסטיים לניתוח שונות בין משתמשים ולכיוון ספי ההתרעה בהתאם למבנה גוף ורמת פעילות, כדי להפחית אזעקות שווא.  

אלה חסמי כניסה שאינם נובעים רק משימוש בספריות ציבוריות, אלא מאוסף של ידע יישומי, נתונים ותהליכי אימון ששחקן חדש יידרש להשקיע זמן ומשאבים ניכרים כדי לשחזר.

אתגרים מרכזיים ומשימות המו"פ להתמודדות  
1. שונות תאורה ורקע  
   • פיתוח תהליך Data Augmentation ספציפי לווידאו ביתי (הוספת רעשים, שינוי טמפרטורת צבע, סימולציה של אור חלון ואור תקרה).  
   • אימון מחדש של מודול ה Pose Estimation על מאגר משולב ציבורי ופרטי.  

2. תנועות חלקיות או מוסתרות  
   • פיתוח מודל השלמת שלד (skeleton completion) שמעריך את מיקום המפרק גם כאשר הוא מוסתר חלקית.  
   • בדיקת רגישות המודל לתצורות שונות של חסימות (רהיטים, חלק גוף אחר).  

3. שונות גבוהה בין משתמשים  
   • הגדרת פרוטוקול כיול קצר של 3 עד 4 תנועות מדודות שנאסף בתחילת השימוש.  
   • פיתוח מודל התאמה אישית המתבסס על נתוני הכיול ומעדכן את ספי ההתרעה.  

4. זמן תגובה במכשירים חלשים  
   • כיווץ מודלים (quantization, pruning) ובחינת מודלים חלופיים ברמת פרמטרים מוגבלת.  
   • ניצול NNAPI באנדרואיד ו Metal ב iOS לשיפור מהירות החישוב ללא שינוי לוגיקת האלגוריתם.

מוצרי צד ג'  
ספריות AI: TensorFlow Lite ו CoreML לצורך הרצת מודלים דחוסים על המכשיר.  
עיבוד תמונה: OpenCV לעיבוד קדם של פריימים.  
ענן: שימוש נקודתי ב AWS או ספק ענן דומה לצורכי אימון מודליםושמירת נתונים, ללא רכישת חומרה ייעודית.  
כלי דגימה: FFmpeg לדגימת מקטעי וידאו לצורכי אימון ובדיקה.

סטטוס נוכחי לעומת יעד והיתכנות במסגרת מסלול תנופה  
כיום:  
• אב טיפוס בסיסי שפועל על 5 סוגי תנועה  
• דיוק של כ 80 אחוז במיצוע כל התנועות  
• זמן עיבוד של כ 5 שניות למקטע אחד  
• מאגר נתונים מצומצם של 120 סרטונים  

יעד בסיום המיזם (עד 12 חודשים):  
• תמיכה ב 20 סוגי תנועה מוגדרים  
• דיוק של 90 אחוז ומעלה בזיהוי מפרקים ו 85 אחוז ומעלה בזיהוי תבניות תנועה חריגות  
• זמן עיבוד של עד 2 שניות למקטע על מכשירי ביניים  
• מאגר נתונים ייעודי של כ 500 סרטונים מתויגים לצורכי אימון ובדיקה  

תוכנית העבודה מחולקת לשלושה שלבים ברורים הניתנים לביצוע במסגרת זמן ותקציב תנופה:  
1. חודשים 1 עד 4: הרחבת מאגר הנתונים, שיפור מודול ה Pose Estimation, בניית גרסת בסיס של מודול הניתוח הדינמי.  
2. חודשים 5 עד 8: פיתוח שכבת ה Transformer הקלה, הוספת מודול כיול אישי, הטמעת טכניקות כיווץ מודלים.



 ---------



market_clients_competition_business_model - סעיף שוק, לקוחות, תחרות ומודל עסקי לדוגמה:

שוק, לקוחות, תחרות ומודל עסקי

השוק הגלובלי ומגמות  
הפתרון מיועד לשוק ה Digital Musculoskeletal Assessment ולשוק ה Tele-rehab: הערכת תנועה, מניעת פציעות ושיקום מרחוק באמצעות וידאו וסמארטפון.  
היקף השוק הגלובלי למערכות שיקום ותנועה דיגיטליות מוערך בכ 7.5 מיליארד דולר עם קצב צמיחה של כ 14 אחוז בשנה, בין השאר בשל:  
1. מעבר מתמשך מטיפול פרונטלי במרפאות לפלטפורמות Telehealth ו Tele-rehab, כולל בקופות חולים וחברות ביטוח.  
2. עלייה בשכיחות בעיות גב ומפרקים באוכלוסייה מזדקנת ובאוכלוסיות שיושבות זמן רב.  
3. האצה בשימוש באפליקציות בריאות ובריאות דיגיטלית מאז תקופת הקורונה.  
4. דרישה גוברת לכלים ביתיים לניטור ומניעה, לא רק לשיקום לאחר פציעה.

פילוח TAM, SAM, SOM  
TAM: כלל השוק העולמי לפתרונות דיגיטליים להערכת תנועה ושיקום מרחוק, כ 7.5 מיליארד דולר בשנה.  
SAM: תת השוק של שירותי הערכת תנועה מרחוק המבוססים על סמארטפון בלבד ללא ציוד נוסף במדינות OECD, מוערך בכ 1.5 מיליארד דולר.  
SOM: בשלב המיזם במסגרת תנופה, המיקוד הוא בשוק מצומצם של פיזיותרפיסטים עצמאיים ומרפאות קטנות ב 2 עד 3 מדינות מובילות, בהיקף יעד של עשרות אלפי משתמשים פוטנציאליים. בשלב זה מתוכנן פיילוט עם עשרות אנשי מקצוע בלבד, כדי לאמת את המוצר והמודל העסקי לפני הרחבה.

פלחי משתמשים ולקוחות משלמים  
1. מקצוענים משלמים B2B:  
   • פיזיותרפיסטים עצמאיים ומרפאות קטנות.  
   • מאמני כושר ומאמני שיקום.  
   • מרפאות תעסוקתיות וחברות ביטוח בריאות המחפשות כלי סינון והערכה מרחוק.  
   לקוחות אלה זקוקים לכלי מהיר ואובייקטיבי שמאפשר להעריך איכות תנועה דרך וידאו קצר, לעקוב אחרי התקדמות ולתעד תוצאות בצורה סטנדרטית.

2. משתמשי קצה B2C:  
   • אנשים עם כאבי גב או מפרקים חוזרים המעוניינים במעקב ביתי.  
   • מתאמנים ביתיים שרוצים לוודא שהם מבצעים תנועות בצורה בטוחה.  
   • משתמשים המעוניינים לקבל התרעה מוקדמת על דפוסי תנועה בעייתיים.  

תיקוף שוק שבוצע  
עד כה בוצעו:  
1. ראיונות עומק עם 12 פיזיותרפיסטים ו 10 מאמני כושר בשתי מדינות. הוצגו להם אב טיפוס ראשוני ומסכי דמו.  
2. פיילוט קטן עם 6 פיזיותרפיסטים שביצעו כ 50 בדיקות תנועה מרחוק באמצעות גרסה ראשונית של המערכת על מטופלים קיימים.  
3. בדיקת נכונות לשלם:  
   • רוב הפיזיותרפיסטים הביעו נכונות לשלם בטווח 15 עד 30 דולר לחודש בעבור כלי עזר פשוט לשימוש, בתנאי שהדיוק והנוחות יאושרו בפיילוטים.  
   • בקרב משתמשי קצה, בבדיקת תגובה למחירי 4.99 עד 7.99 דולר לחודש, התקבלה הסכמה עקרונית למחיר אם המערכת תספק חיווי ברור ולא תדרוש ציוד נוסף.  

מהפיילוטים עלו שלוש תובנות מרכזיות:  
• לצוותים קליניים חשוב שיהיה תיעוד מסודר שמאפשר להשוות בדיקות לאורך זמן.  
• נדרש חיווי פשוט, בשפה לא מקצועית, כדי שמטופלים יבינו את ההנחיות.  
• ברור שיש עדיפות לכלי שעובד על סמארטפון יחיד ללא מצלמות עומק או ציוד נוסף.

שיתופי פעולה קיימים ומתוכננים  
1. קיימים:  
   • שיתוף פעולה ראשוני עם שתי מרפאות פיזיותרפיה פרטיות לביצוע פיילוט מורחב במהלך תקופת המענק.  
   • הבנות עקרוניות עם מאמן כושר מוביל שילווה את התאמת המוצר לשימוש יום יומי באימוני בית.  

2. מתוכננים:  
   • הרחבת הפיילוט לרשת מרפאות קטנה במדינה אחת, אם תתקבל תוצאה חיובית מהפיילוט הראשוני.  
   • בדיקת אינטגרציה ראשונית עם מערכת ניהול מרפאה קיימת, כדי לאפשר עבודה מתוך כלי אחד.  

מודל עסקי והגיון לשלב המוקדם  
בשלב תנופה, המיקוד הוא על אימות מודל ההכנסות ולא על הכנסות משמעותיות.  
המודלים שנבדקים:  
1. B2B מנוי חודשי למקצוענים:  
   Basic: כ 19 דולר לחודש, כולל מכסה מוגבלת של בדיקות ומסך דוחות בסיסי.  
   Pro: כ 39 דולר לחודש, כולל יותר בדיקות, דוחות מפורטים וייצוא נתונים.  
   בתקופת המענק ייבדקו בפיילוט בעיקר מסלולי ה Basic, כדי להבין היתכנות ותמחור לפני הרחבה לתוכניות מתקדמות.  

2. B2C מנוי חודשי למשתמשי קצה:  
   מחיר יעד התחלתית 5.99 עד 6.99 דולר לחודש, אך בשלב תנופה הדגש הוא על בדיקות שימושיות והבנת ערך נתפס, ולא על סקייל.  

3. White Label ורישוי:  
   נבחנים כערוץ עתידי בלבד. בתקופת המענק יתבצע לכל היותר פיילוט נקודתי מול גוף אחד, כדי ללמוד דרישות אינטגרציה, ללא הסתמכות על הכנסות מהערוץ הזה.

מתחרים והחלופות  
1. פתרונות שיקום דיגיטליים קיימים, כמו אפליקציות שמנחות סט תרגילים מלא לשיקום: מתמקדות בפרוטוקול תרגול, לא בבדיקת תנועה קצרה לאבחון והתרעה.  
2. מערכות מבוססות מצלמות עומק או מספר מצלמות: מספקות דיוק גבוה אך דורשות ציוד יקר ותנאי התקנה ייעודיים, ולכן אינן מתאימות לשימוש ביתי רחב.  
3. אפליקציות כושר כלליות: מציעות וידאו הדרכתי או ספירת חזרות, אך אינן מספקות מדדים אובייקטיביים של איכות תנועה בתנאי בית ולא מותאמות לצרכים קליניים בסיסיים.  

הבידול  
1. שימוש בסמארטפון יחיד ללא ציוד נוסף, עם התאמה ספציפית לתנאי בית.  
2. מיקוד בבדיקת תנועה קצרה והפקת מדדים כמותיים לשיחה בין איש מקצוע למטופל, ולא רק תרגול.  
3. שכבת כיול אישי המותאמת למבנה הגוף של כל משתמש, מה שמאפשר דיוק טוב יותר במעקב לאורך זמן.  
4. תכנון מראש לעבודה משולבת: כלי עבור המטפל וכלי פשוט למטופל, במקום מוצר שמיועד רק לאחד הצדדים.

חסמי כניסה לשוק ואופן ההתמודדות  
החסמים העיקריים:  
1. אמון של אנשי מקצוע:  
   • התמודדות: ביצוע פיילוטים מבוקרים עם מספר מצומצם של מרפאות, הפקת דו"חות השוואתיים בין הערכת המערכת להערכת איש המקצוע, ושימוש בתוצאות ליצירת case studies.  

2. עומס אפליקציות בשוק הבריאות והכושר:  
   • התמודדות: מיתוג ככלי מקצועי לפיזיותרפיסטים ולא כאפליקציית כושר כללית, והפצה דרך אנשי מקצוע ולא דרך חנויות האפליקציות בלבד.  

3. דרישה להוכחת ערך קליני בסיסי:  
   • התמודדות: מדידה שיטתית של מדדים פשוטים, כמו יציבות, טווח תנועה ושינוי לאורך זמן, והצגתם בשפה קלינית בסיסית שאינה מחליפה שיקול דעת רפואי אלא מוסיפה שכבת מידע.  

במסגרת תקופת תנופה יושם דגש על בניית אמון ודיוק במקטע שוק קטן ומוגדר, ולא על חדירה רחבה לכל פלחי 
השוק, בהתאמה לשלב המוקדם של המיזם.


פורמט התשובה:  
אתה מחזיר אובייקט JSON אחד בלבד, ללא טקסט נוסף.  
לכל סעיף שקיים ב application_form יש מפתח נפרד באובייקט, ושמו בדיוק כשם הסעיף. ערך כל מפתח הוא מערך מחרוזות של הערות עבור אותו סעיף.

לדוגמה:  
{
  "executive_summary": [ "הערה אחת", "הערה שניה" ],
  "the_need": [ "..." ]
}

כל מחרוזת היא הערה אחת.  
אין להשתמש במספור.  
אם אין הערות לסעיף מסוים, החזר עבורו מערך המכיל איבר אחד: "אין הערות".



{
  "general_instructions": {
    "question": "הנחיות כלליות לטופס תנופה",
    "review_guidelines": [
      "המיזם חייב להיות מיזם טכנולוגי עם חדשנות טכנולוגית אמיתית, לא רק יוזמה עסקית, שיווקית או חברתית.",
      "כל הסעיפים בטופס צריכים לשקף מוצר וטכנולוגיה המיועדים לשוק גלובלי, ולא להתמקד רק בשוק הישראלי.",
      "שלב המיזם הוא מחקר ופיתוח ראשוני, הוכחת התכנות או אב טיפוס ראשון, ולא מוצר מסחרי בשל או פעילות מסחרית רחבה.",
      "התקציב הכולל של התוכנית אינו עולה על 250,000 ש\"ח, והמענק המבוקש אינו עולה על 200,000 ש\"ח (עד 80 אחוז מימון). התיאורים בטופס חייבים להיות סבירים ביחס לגבולות אלה.",
      "משך התוכנית אינו עולה על 12 חודשים, וכל המשימות, היעדים והתוצרים המתוארים בטופס צריכים להיות ברי ביצוע במסגרת זמן זו.",
      "במסלול תנופה אין שכר, שכירות משרדים, נסיעות, חשמל, טלפון או תקורות. יש להימנע מניסוח שמרמז על הסתמכות על הוצאות כאלה כחלק מהתוכנית הממומנת.",
      "הוצאות מותרות כוללות בעיקר פעילות מו\"פ, חומרים, אב טיפוס, קבלני משנה מקצועיים, ייעוץ מקצועי, פטנטים, התאמת מוצר ותיקוף שוק בהיקף מוגבל על פי הנהלים.",
      "רוב המשאבים והטקסט בטופס צריכים לשקף פעילות מו\"פ משמעותית ולא להתמקד בשיווק, מכירות או תפעול שוטף.",
      "בכל הסעיפים צריכה להיות עקביות מלאה: אותו מוצר, אותו צורך, אותו שוק יעד, אותה טכנולוגיה, אותן משימות ואותו קניין רוחני.",
      "הטקסט בכל סעיף צריך להיות ברור, ענייני ותמציתי, ללא סופרלטיבים מוגזמים, ללא הבטחות לא ריאליות וללא ניסוח שיווקי בלבד.",
      "בכל מקום רלוונטי יש לקשור את התיאור לעקרונות המפתח של המסלול: חדשנות טכנולוגית, יכולת ביצוע וישימות, פוטנציאל צמיחה עסקי גלובלי ותרומה טכנולוגית ותעסוקתית לכלכלה הישראלית.",
      "יש לזכור שהטופס והתקציב נקראים יחד: כל מה שמתואר כתוכן, משימות ותוצרים צריך להיות ניתן למימון במסגרת סוגי ההוצאות המותרים וללא חריגה מהמגבלות הפורמליות של מסלול תנופה."
    ]
  },
  "executive_summary": {
    "question": "סיכום מנהלים",
    "instructions": "להציג בקצרה נושאים מרכזיים במיזם החשובים לוועדה: הצורך במיזם, המוצר שיפותח, הטכנולוגיה, מידת החדשנות, עיקרי תכולת הפיתוח והיעדים שיידחפו בעזרת המענק, השוק הרלוונטי, תיקוף שבוצע, מתחרים, הזדמנות עסקית, מודל עסקי ותוכניות לגיוס הון.",
    "max_length": "15 שורות",
    "review_guidelines": [
      "לכתוב תמצית ברורה וקצרה של כלל המיזם: הצורך, המוצר, הטכנולוגיה, התקדמות קיימת, השוק והמתחרים, והמטרה של המענק.",
      "הסיכום מועתק כלשונו לחוות הדעת ולכן חייב להיות חד, ברור ונקי מרעש.",
      "לכתוב בגופן קריא וברור.",
      "להתייחס בצורה תמציתית לכל נקודות הליבה שנבחנות במסלול.",
      "לדבר תמיד על השוק במבט גלובלי ולא מקומי בלבד.",
      "להציג את מהות הפרויקט בכמה מילים כבר בשורות הראשונות."
    ]
  },
  "the_need": {
    "question": "הצורך",
    "instructions": "לתאר ולפרט מהי הבעיה או הצורך בשוק שלמענם נועדו מוצרי המיזם, וכיצד הם מצדיקים את קיום המיזם.",
    "max_length": null,
    "review_guidelines": [
      "לתאר את הצורך המיידי והמוגדר שהמוצר בא לתת לו מענה.",
      "להראות שהצורך הוא אמיתי, משמעותי, וקשור לשוק גלובלי.",
      "להציג קשר ברור בין הצורך לבין המוצר המוצע.",
      "להראות שהבנת השוק אינה תיאורטית בלבד אלא מבוססת על בחינה ראשונית או שיחות עם שוק."
    ]
  },
  "the_product": {
    "question": "המוצר",
    "instructions": "לתאר לכל אחד ממוצרי המיזם את המוצר עצמו והאופן שבו הוא נותן מענה לצורך, את מרכיבי המוצר ורכיביו העיקריים, עקרונות הפעולה, תרחישי השימוש ושילוב עתידי במוצרים נוספים.",
    "max_length": null,
    "review_guidelines": [
      "לתאר כל אחד ממוצרי המיזם בצורה ברורה.",
      "לפרט מרכיבי מוצר, רכיבים עיקריים ותרחישי שימוש.",
      "להציג התאמה מלאה בין המוצר לבין הצורך שהוצג בסעיף הקודם.",
      "לתאר איך המוצר מספק פתרון לצורך בצורה שאינה כללית מדי.",
      "אם יש יותר ממוצר אחד: להסביר את ההבדלים ואת הקשר ביניהם.",
      "להימנע מהבטחות לא ריאליות ביחס לשלב בו נמצאים."
    ]
  },
  "team_and_capabilities": {
    "question": "הצוות ויכולות המיזם, פערים ביכולות",
    "instructions": "לתאר את הרקע והניסיון הרלוונטי של אנשי המפתח וצוות הפיתוח, קבלני משנה מהותיים, יועצים ומלווים, משקיעים ושותפים אסטרטגיים, וכן את הפערים בין היכולות הקיימות לדרושות לביצוע המיזם וכיצד המענק יסייע בגישור.",
    "max_length": null,
    "review_guidelines": [
      "לתאר את הרקע, הניסיון והידע הרלוונטי של כל אנשי הצוות.",
      "להבהיר כיצד יכולות הצוות מאפשרות לבצע את תוכנית הפיתוח.",
      "אם יזם חסר רקע רלוונטי: להסביר בבירור את הקשר שלו לרעיון.",
      "לתאר פערי יכולות, ולהסביר כיצד מגשרים על כל פער.",
      "רק יזמים פעילים ניתן לכלול, מאחר ואין שכר במסלול.",
      "לתאר שימוש בקבלני משנה רק כאשר יש כיסוי בתקציב ובמשימות.",
      "במקרים של ידע ממוסד אקדמי: לציין את הצורך בשחרור ידע.",
      "הצוות הרשום בטופס הוא הצוות שמפתח בפועל את המיזם."
    ]
  },
  "intellectual_property": {
    "question": "קניין רוחני",
    "instructions": "להסביר כיצד נבדק שאין הפרת זכויות של אחרים, לפרט את זכויות הקניין בידע המקדמי ואת דרך השגת זכויות שימוש, לתאר שימוש ברכיבי צד ג', לפרט פטנטים שהוגשו או מתוכננים, את הבעלות במוצרי המיזם ובידע שיפותח, הסדרי בעלות משותפת אם קיימים, והאם יפותח/ישוחרר קוד פתוח.",
    "max_length": null,
    "review_guidelines": [
      "לתאר את מצב הקניין הרוחני של המיזם במועד ההגשה.",
      "להבהיר שכל הידע שיפותח יהיה בבעלות החברה או היזמים.",
      "אם יש ידע ממוסדות אקדמיים: לציין את הצורך בהסכמי שימוש ושחרור ידע.",
      "לפרט אם יש פטנט רשום, בתהליך, או כוונה לפעול לרישום.",
      "לתאר שימוש ברכיבי צד ג' וקוד פתוח, כולל הרשאות.",
      "להציג בעלות מלאה וברורה על המוצר הסופי."
    ]
  },
  "technology_uniqueness_innovation": {
    "question": "הטכנולוגיה, ייחודיות וחדשנות, חסמי כניסה טכנולוגיים, אתגרים, מוצרי צד ג'",
    "instructions": "לתאר את הטכנולוגיות שיפותחו, עיקרי מפרט הביצועים, ביסוס והנמקת ההנחות הטכנולוגיות, חסמי הכניסה הטכנולוגיים, מידת הייחודיות והחדשנות לעומת פתרונות קיימים, האתגרים המרכזיים בתהליך הפיתוח ואופן ההתמודדות עמם, וכן את סטטוס המוצר כיום לעומת היעד בסיום המיזם.",
    "max_length": null,
    "review_guidelines": [
      "לתאר בבירור את הטכנולוגיה שתפותח במסגרת המיזם.",
      "להציג חדשנות טכנולוגית אמיתית, לא רק פונקציונליות או UX.",
      "להראות מה שונה ממה שקיים כיום בשוק.",
      "לתאר את עומק המו\"פ והידע שמפותח מאחורי המוצר.",
      "להציג אתגרים טכנולוגיים ממשיים ולא קוסמטיים.",
      "להציג חסמי כניסה טכנולוגיים ולא שיווקיים.",
      "להתייחס להיתכנות ולהראות כיצד מתכננים להתמודד עם הסיכונים.",
      "לתאר את סטטוס הפיתוח הנוכחי ומה צפוי להיבנות בתקופת המענק.",
      "לוודא שכל מה שמתואר מתאים לתקציב ולמגבלות המסלול (אין שכר, אין ציוד יקר, אין פעילות שלא ניתנת למימון)."
    ]
  },
  "tasks_and_activities": {
    "question": "משימות ופעילויות במיזם זה",
    "instructions": "לפרט בטבלאות את משימות המו\"פ והפעילויות הנוספות. כל שורה מתארת משימה אחת: שם, תיאור ברור, ומועדי תחילה וסיום בפורמט חודשי.",
    "max_length": null,
    "review_guidelines": [
      "לפרט את משימות הפיתוח בטבלה: שם משימה, תיאור, תאריך התחלה ותאריך סיום.",
      "רוב המשימות חייבות להיות משימות מו\"פ ולא משימות עסקיות.",
      "בכל משימה יש לכתוב מה בדיוק יבוצע, ולא רק כותרת כללית.",
      "תקופת הביצוע חייבת להתאים ללוחות הזמנים המותרים (עד 12 חודשים).",
      "להוסיף פעילויות שאינן מו\"פ רק בסעיף 8.2, במספר מצומצם.",
      "להבטיח התאמה בין המשימות לבין יכולות הצוות והתקציב.",
      "רוב התקציב צריך להיות מושקע בפיתוח ולא בפעילויות אחרות.",
      "לא לכלול משימות הכוללות שכר, שכירות, תפעול או תקורות."
    ]
  },
  "market_clients_competition_business_model": {
    "question": "שוק, לקוחות, תחרות ומודל עסקי",
    "instructions": "לתאר את פלחי השוק, מגמות, היקף וצמיחה, אפיון המשתמשים והלקוחות המשלמים, תיקוף שוק שבוצע ומוכנות לקוחות לשלם, שיתופי פעולה קיימים/מתוכננים, המודל העסקי ומקורות ההכנסה, חלופות קיימות ויתרונות המוצר עליהן, מתחרים ישירים ועקיפים והבידול מולם, חסמי כניסה לשוק ואופן ההתמודדות עמם.",
    "max_length": null,
    "review_guidelines": [
      "להציג את השוק במבט גלובלי, לא מקומי בלבד.",
      "לתאר את הלקוחות: מי הם, כיצד מאפיינים אותם, והאם התקיים קשר ראשוני כלשהו.",
      "להציג תיקוף שוק ראשוני שנעשה (שיחות, בדיקות, למידה).",
      "לא נדרש סקר שוק מקיף, אך חייב להיות בוצע תיקוף ראשוני כלשהו.",
      "לתאר את המתחרים בצורה מציאותית ורלוונטית.",
      "להראות הבנה של פתרונות קיימים ומה היתרון המוצע.",
      "לתאר חסמי כניסה לשוק הקשורים לשוק עצמו.",
      "להראות קשר ישיר בין השוק והמוצר שאתם מפתחים.",
      "להציג מודל עסקי ברור וריאלי לשלב מוקדם."
    ]
  },
  "grant_contribution_to_success": {
    "question": "תרומת מענק תנופה להצלחת המיזם",
    "instructions": "להסביר כיצד המענק יסייע להגיע לאבן דרך משמעותית, מה יתאפשר בזכותו, ומהי אסטרטגיית גיוס המימון בתקופת המיזם ולאחריה.",
    "max_length": null,
    "review_guidelines": [
      "להסביר בצורה ברורה כיצד המענק יקדם את המיזם מאבן דרך אחת לאחרת.",
      "להראות שהמענק משמעותי ולא רק \"נוח\" או \"מסייע\".",
      "לתאר את הערך של המענק עבור הגעה ל-הוכחת התכנות (POC) או אב טיפוס.",
      "להבחין בין שלבים שונים בתוכנית אם קיימים (למשל חלק א' וחלק ב').",
      "להסביר כיצד המענק מסייע לקראת גיוס הון עתידי."
    ]
  },
  "royalties": {
    "question": "תמלוגים",
    "instructions": "לפרט, אם רלוונטי, אילו טכנולוגיות ומוצרים צפויים להניב הכנסות שבעתיד יחויבו בתמלוגים, ולקשר בין כל טכנולוגיה לבין מסלול ההכנסה.",
    "max_length": null,
    "review_guidelines": [
      "לתאר אילו מוצרים או טכנולוגיות עשויים להניב הכנסות בעתיד.",
      "להסביר כיצד המוצר המסוים צפוי להיות מקור לתמלוגים במידת הצלחה.",
      "לשמור על עקביות בין התוצרים הצפויים לבין המוצרים שתוארו בסעיפים אחרים.",
      "לציין בקצרה שהתמלוגים הם לפי הכללים הידועים בתנופה, בלי פירוט משפטי מיותר."
    ]
  },
  "economic_and_technological_contribution": {
    "question": "התרומה הטכנולוגית והתעסוקתית הצפויה של המיזם לכלכלה הישראלית",
    "instructions": "לתאר את תרומת המיזם לכלכלה הישראלית: תעסוקה כולל בפריפריה, הקמת פעילות פיתוח או ייצור בישראל, השפעות עקיפות על התעשייה, והאם אחד היזמים משתייך לאוכלוסיות בתת ייצוג ולהרחיב ככל שיש לכך השלכה.",
    "max_length": null,
    "review_guidelines": [
      "לתאר את התרומה הישירה והעקיפה của המיזם לכלכלה הישראלית.",
      "להתייחס לפוטנציאל תעסוקתי עתידי, לפיתוח, לשיתופי פעולה, או לידע ייחודי שייווצר בישראל.",
      "להציג בצורה ריאלית את פוטנציאל ההשפעה בהתחשב בשלב המוקדם של המיזם.",
      "אם אחד היזמים שייך לאוכלוסייה בתת ייצוג: לציין זאת במידה ורלוונטי לסעיף.",
      "אם יש ייצור: לציין היכן יתבצע ומה ההשפעה על התעסוקה בישראל."
    ]
  }
}

להלן התשובות להערכה:'''


def is_instruction_text(text):
    instruction_starters = [
        "תאר ופרט", "יש להציג", "יש לפרט", "הנחיה למילוי",
        "ציין האם", "שים לב!", "ככל שרלוונטי, תאר", "ככל שרלוונטי, פרט",
        "הסבר כיצד", "יש להתייחס לנושאים"
    ]
    for starter in instruction_starters:
        if text.startswith(starter):
            return True
    if text.count("[1]") > 0 and text.count("[2]") > 0:
        return True
    return False


def extract_from_docx_binary(binary_data):
    try:
        docx_bytes = io.BytesIO(binary_data)
        doc = Document(docx_bytes)
    except Exception as e:
        raise Exception(f"Failed to load document: {str(e)}")

    json_structure = {
        "executive_summary": {"question": "סיכום מנהלים"},
        "the_need": {"question": "הצורך"},
        "the_product": {"question": "המוצר"},
        "team_and_capabilities": {"question": "הצוות ויכולות המיזם, פערים ביכולות"},
        "intellectual_property": {"question": "קניין רוחני"},
        "technology_uniqueness_innovation": {
            "question": "הטכנולוגיה, ייחודיות וחדשנות, חסמי כניסה טכנולוגיים, אתגרים, מוצרי צד ג'"
        },
        "tasks_and_activities": {"question": "משימות ופעילויות במיזם זה"},
        "market_clients_competition_business_model": {
            "question": "שוק, לקוחות, תחרות ומודל עסקי"
        },
        "grant_contribution_to_success": {"question": "תרומת מענק תנופה להצלחת המיזם"},
        "royalties": {"question": "תמלוגים"},
        "economic_and_technological_contribution": {
            "question": "התרומה הטכנולוגית והתעסוקתית הצפויה של המיזם לכלכלה הישראלית"
        }
    }

    section_keywords = {
        "executive_summary": ["סיכום מנהלים"],
        "the_need": ["הצורך"],
        "the_product": ["המוצר"],
        "team_and_capabilities": ["הצוות", "פערים", "עובדי מוסד", "מסגרת תומכת"],
        "intellectual_property": ["קניין רוחני", "בעלות במוצרי", "קוד פתוח", "פטנט"],
        "technology_uniqueness_innovation": ["טכנולוגיה", "ייחודיות", "חדשנות", "אתגרים"],
        "tasks_and_activities": ["משימות"],
        "market_clients_competition_business_model": [
            "שוק", "לקוחות", "תיקוף שוק", "מודל עסקי", "תחרות", "מתחרים", "חסמי כניסה"
        ],
        "grant_contribution_to_success": ["תרומת מענק", "מענק תנופה"],
        "royalties": ["תמלוגים"],
        "economic_and_technological_contribution": [
            "תרומה הטכנולוגית", "תרומה התעסוקתית", "תרומה"
        ]
    }

    result = {
        key: {
            "question": value["question"],
            "answer": ""
        } for key, value in json_structure.items()
    }

    section_content = {key: [] for key in json_structure.keys()}

    for element in doc.element.body:
        content_text = None

        if isinstance(element, CT_P):
            para = Paragraph(element, doc)
            text = para.text.strip()
            if text and text != "הזן טקסט כאן..." and not is_instruction_text(text):
                content_text = text

        elif isinstance(element, CT_Tbl):
            table = Table(element, doc)
            for row in table.rows:
                for cell in row.cells:
                    text = cell.text.strip()
                    if text and text != "הזן טקסט כאן..." and not is_instruction_text(text):
                        content_text = text
                        break
                if content_text:
                    break

        if content_text:
            for section_key, keywords in section_keywords.items():
                if any(keyword in content_text for keyword in keywords):
                    section_content[section_key].append(content_text)
                    break

    for section_key, content_parts in section_content.items():
        if content_parts:
            seen = set()
            unique_parts = []
            for part in content_parts:
                if part not in seen:
                    seen.add(part)
                    unique_parts.append(part)
            result[section_key]["answer"] = "\n\n".join(unique_parts)

    return result


@app.route("/", methods=["GET"])
def home():
    return jsonify({"status": "web extract v2"})


@app.route("/extract", methods=["POST"])
def extract():
    try:
        if "file" not in request.files:
            return jsonify({"error": "missing file field"}), 400

        uploaded_file = request.files["file"]
        if not uploaded_file.filename:
            return jsonify({"error": "empty filename"}), 400

        file_data = uploaded_file.read()
        result = extract_from_docx_binary(file_data)
        return jsonify(result)
    except Exception as e:
        return jsonify({"error": str(e)}), 500


@app.route("/review", methods=["POST"])
def review():
    try:
        if "file" not in request.files:
            return jsonify({"error": "missing file field"}), 400

        uploaded_file = request.files["file"]
        if not uploaded_file.filename:
            return jsonify({"error": "empty filename"}), 400

        file_data = uploaded_file.read()
        sections = extract_from_docx_binary(file_data)

        application_json_str = json.dumps(sections, ensure_ascii=False)
        full_prompt = BASE_PROMPT + "\n" + application_json_str

        resp = client.chat.completions.create(
            model="gpt-5",
            response_format={"type": "json_object"},
            messages=[
                {
                    "role": "system",
                    "content": "החזר רק אובייקט JSON אחד כמוגדר בהנחיות, ללא טקסט נוסף."
                },
                {
                    "role": "user",
                    "content": full_prompt
                }
            ],
        )

        content = resp.choices[0].message.content

        try:
            review_obj = json.loads(content)
        except Exception:
            review_obj = {"raw": content}

        return jsonify(review_obj)
    except Exception as e:
        return jsonify({"error": str(e)}), 500


if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    app.run(host="0.0.0.0", port=port)
